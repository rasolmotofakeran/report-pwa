
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ú¯Ù„Ø®Ø§Ù†Ù‡ (ÙØ¹Ø§Ù„ÛŒØª Ù…Ø¬Ø²Ø§)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-date/dist/persian-date.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css" />
  
  <style>
    body {
      font-family: Tahoma, sans-serif;
      padding: 16px;
      background-color: #f0f4f8;
      color: #333;
      max-width: 100%;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      font-size: 20px;
    }
    label {
      display: block;
      margin-top: 14px;
      font-weight: bold;
      font-size: 15px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      margin-top: 14px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .report-box {
      background: #fff;
      padding: 10px;
      margin-top: 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    button:hover { opacity: 0.95; }
    .btn-green { background: #4CAF50; color: #fff; }
    .btn-red { background: #f44336; color: #fff; }
    .btn-blue { background: #2196F3; color: #fff; }
    .btn-purple { background: #9C27B0; color: #fff; }
    .btn-gray { background: #607d8b; color: #fff; }
    .btn-yellow { background: #fbc02d; color: #fff; }
    @media (max-width: 600px) {
      h1 { font-size: 18px; }
      label { font-size: 14px; }
      input, select, textarea { font-size: 13px; }
      button { font-size: 15px; }
    }
  </style>

</head>
<body>
  <h1>ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØª Ø±ÙˆØ²Ø§Ù†Ù‡</h1>

  <label>ØªØ§Ø±ÛŒØ® (Ø´Ù…Ø³ÛŒ)</label>
  <input type="text" id="report-date" readonly style="background:#fff; cursor:pointer;" />

  <label>Ù†Ø§Ù… Ø³Ø§Ù„Ù†</label>
  <select id="greenhouse-name">
    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ù„Ù†</option>
    <option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 1">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 1</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 2">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 2</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 3">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 3</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 4">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 4</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 5">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 5</option><option value="ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 6">ÙØ§Ø² 1 Ø³Ø§Ù„Ù† 6</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 1">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 1</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 2">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 2</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 3">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 3</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 4">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 4</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 5">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 5</option><option value="ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 6">ÙØ§Ø² 2 Ø³Ø§Ù„Ù† 6</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 1">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 1</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 2">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 2</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 3">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 3</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 4">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 4</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 5">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 5</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 6">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 6</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 7">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 7</option><option value="ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 8">ÙØ§Ø² 3 Ø³Ø§Ù„Ù† 8</option>
  </select>

  <label>Ù†ÙˆØ¹ ÙØ¹Ø§Ù„ÛŒØª</label>
  <select id="task-type">
    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ¹Ø§Ù„ÛŒØª</option>
    <option value="irrigation">Ø¢Ø¨ÛŒØ§Ø±ÛŒ</option>
    <option value="spraying">Ù…Ø­Ù„ÙˆÙ„â€ŒÙ¾Ø§Ø´ÛŒ</option>
    <option value="pesticide">Ø³Ù…â€ŒÙ¾Ø§Ø´ÛŒ</option>
    <option value="harvest">Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ø­ØµÙˆÙ„</option>
    <option value="repair">ØªØ¹Ù…ÛŒØ±Ø§Øª</option>
    <option value="maintenance">Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ</option>
    <option value="other">Ø³Ø§ÛŒØ±</option>
  </select>

  <div id="desc-fields">
    <label id="label-irrigation" style="display:none;">ØªÙˆØ¶ÛŒØ­ Ø¢Ø¨ÛŒØ§Ø±ÛŒ</label>
    <textarea id="desc-irrigation" style="display:none;" rows="2"></textarea>

    <label id="label-spraying" style="display:none;">ØªÙˆØ¶ÛŒØ­ Ù…Ø­Ù„ÙˆÙ„â€ŒÙ¾Ø§Ø´ÛŒ</label>
    <textarea id="desc-spraying" style="display:none;" rows="2"></textarea>

    <label id="label-pesticide" style="display:none;">ØªÙˆØ¶ÛŒØ­ Ø³Ù…â€ŒÙ¾Ø§Ø´ÛŒ</label>
    <textarea id="desc-pesticide" style="display:none;" rows="2"></textarea>

    <label id="label-harvest" style="display:none;">ØªÙˆØ¶ÛŒØ­ Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ø­ØµÙˆÙ„</label>
    <textarea id="desc-harvest" style="display:none;" rows="2"></textarea>

    <label id="label-repair" style="display:none;">ØªÙˆØ¶ÛŒØ­ ØªØ¹Ù…ÛŒØ±Ø§Øª</label>
    <textarea id="desc-repair" style="display:none;" rows="2"></textarea>

    <label id="label-maintenance" style="display:none;">ØªÙˆØ¶ÛŒØ­ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ</label>
    <textarea id="desc-maintenance" style="display:none;" rows="2"></textarea>

    <label id="label-other" style="display:none;">ØªÙˆØ¶ÛŒØ­ Ø³Ø§ÛŒØ±</label>
    <textarea id="desc-other" style="display:none;" rows="2"></textarea>
  </div>

  <label>Ø²Ù…Ø§Ù† Ø§Ù†Ø¬Ø§Ù…</label>
  <input type="text" id="task-time" placeholder="Ù…Ø«Ù„Ø§Ù‹ Û±Û° ØµØ¨Ø­" />

  <label>Ù†Ø§Ù… Ù…Ø³Ø¦ÙˆÙ„</label>
  <input type="text" id="task-person" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÛŒ" />

  <label>Ø´Ø±Ø§ÛŒØ· Ø¨ÙˆØªÙ‡â€ŒÙ‡Ø§</label>
  <textarea id="plant-status" rows="3" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø±Ø´Ø¯ Ù…ØªÙˆÙ‚Ù Ø´Ø¯Ù‡ØŒ Ø²Ø±Ø¯ÛŒ Ø¨Ø±Ú¯ØŒ Ø´Ø§Ø®Ù‡â€ŒØ¯Ù‡ÛŒ Ú©Ù…"></textarea>

  <button onclick="saveReport()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ú¯Ø²Ø§Ø±Ø´</button>
  <button onclick="clearReports()">ğŸ—‘ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ</button>
  <button onclick="downloadReports()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ JSON</button>

  
  <input type="file" id="fileLoader" accept="application/json" />
  <button onclick="loadFromFile()">ğŸ“‚ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ JSON</button>
  <button onclick="shareData()">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>

<div id="report-list"></div>

  <script>
    $('#report-date').persianDatepicker({
      initialValueType: 'persian',
      format: 'YYYY/MM/DD',
      autoClose: true
    });

    const descMap = {
      irrigation: "desc-irrigation",
      spraying: "desc-spraying",
      pesticide: "desc-pesticide",
      harvest: "desc-harvest",
      repair: "desc-repair",
      maintenance: "desc-maintenance",
      other: "desc-other"
    };

    document.getElementById("task-type").addEventListener("change", function() {
      Object.keys(descMap).forEach(key => {
        document.getElementById("desc-" + key).style.display = "none";
        document.getElementById("label-" + key).style.display = "none";
      });
      const selected = this.value;
      if (descMap[selected]) {
        document.getElementById("desc-" + selected).style.display = "block";
        document.getElementById("label-" + selected).style.display = "block";
      }
    });

    function getKey() {
      const hall = document.getElementById("greenhouse-name").value;
      const type = document.getElementById("task-type").value;
      return "greenhouseReports_" + hall + "_" + type;
    }

    function saveReport() {
      const taskSelect = document.getElementById("task-type");
      const taskValue = taskSelect.value;
      const taskText = taskSelect.options[taskSelect.selectedIndex].text;
      const descField = descMap[taskValue] || '';
      const descValue = descField ? document.getElementById(descField).value : '';
      const report = {
        date: document.getElementById("report-date").value,
        hall: document.getElementById("greenhouse-name").value,
        type: taskText,
        desc: descValue,
        time: document.getElementById("task-time").value,
        person: document.getElementById("task-person").value,
        plant: document.getElementById("plant-status").value
      };
      if (!report.date || !report.hall || !taskValue || !descValue || !report.time || !report.person) {
        alert("Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø§ÛŒØ¯ Ù¾Ø± Ø´ÙˆÙ†Ø¯.");
        return;
      }
      const key = getKey();
      const reports = JSON.parse(localStorage.getItem(key) || "[]");
      reports.push(report);
      localStorage.setItem(key, JSON.stringify(reports));
      alert("âœ… Ú¯Ø²Ø§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯");
      renderReports();
    }

    function renderReports() {
      const key = getKey();
      const container = document.getElementById("report-list");
      const reports = JSON.parse(localStorage.getItem(key) || "[]");
      if (!reports.length) {
        container.innerHTML = "<p style='color:#777'>Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³Ø§Ù„Ù† Ùˆ ÙØ¹Ø§Ù„ÛŒØª ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>";
        return;
      }
      container.innerHTML = reports.map(r => `
        <div class="report-box">
          <strong>ØªØ§Ø±ÛŒØ®:</strong> ${r.date}<br>
          <strong>Ø³Ø§Ù„Ù†:</strong> ${r.hall}<br>
          <strong>ÙØ¹Ø§Ù„ÛŒØª:</strong> ${r.type}<br>
          <strong>ØªÙˆØ¶ÛŒØ­:</strong> ${r.desc}<br>
          <strong>Ø²Ù…Ø§Ù†:</strong> ${r.time}<br>
          <strong>Ù…Ø³Ø¦ÙˆÙ„:</strong> ${r.person}<br>
          <strong>Ø´Ø±Ø§ÛŒØ· Ø¨ÙˆØªÙ‡:</strong> ${r.plant}
        </div>
      `).join('');
    }

    function clearReports() {
      const key = getKey();
      localStorage.removeItem(key);
      renderReports();
    }

    function downloadReports() {
      const key = getKey();
      const data = localStorage.getItem(key);
      if (!data) return alert("Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = key + ".json";
      a.click();
      URL.revokeObjectURL(url);
    }

    
    function loadFromFile() {
      const key = getKey();
      const fileInput = document.getElementById("fileLoader");
      const file = fileInput.files[0];
      if (!file) return alert("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ JSON Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          if (!Array.isArray(imported)) throw "ÙØ±Ù…Øª ÙØ§ÛŒÙ„ Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.";
          localStorage.setItem(key, JSON.stringify(imported));
          alert("âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯");
          renderReports();
        } catch (err) {
          alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„: " + err);
        }
      };
      reader.readAsText(file);
    }

    function shareData() {
      const key = getKey();
      const data = JSON.parse(localStorage.getItem(key) || "[]");
      if (!data.length) return alert("Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.");
      const last = data[data.length - 1];
      const msg = `ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡
ØªØ§Ø±ÛŒØ®: ${last.date}
Ø³Ø§Ù„Ù†: ${last.hall}
ÙØ¹Ø§Ù„ÛŒØª: ${last.type}
ØªÙˆØ¶ÛŒØ­: ${last.desc}
Ø²Ù…Ø§Ù†: ${last.time}
Ù…Ø³Ø¦ÙˆÙ„: ${last.person}
Ø´Ø±Ø§ÛŒØ· Ø¨ÙˆØªÙ‡: ${last.plant}`;
      if (navigator.share) {
        navigator.share({ text: msg }).catch(() => alert("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ share"));
      } else {
        prompt("ğŸ”— Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ:", msg);
      }
    }

    
    document.getElementById("greenhouse-name").addEventListener("change", renderReports);
    document.getElementById("task-type").addEventListener("change", renderReports);
    window.onload = renderReports;
    
  </script>
</body>
</html>
